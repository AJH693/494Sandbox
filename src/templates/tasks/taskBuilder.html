{% include "tasks/tasks_js.js" %}
{% extends "layout.html" %}
{% block header_css %}
<head>
    <title>Layout Selector</title>
    {{ super() }}
</head>
{% endblock %}
{% block body %}
<div class="row">
  <!-- Sidebar -->
  <div class="col-md-1 EDIT_ONLY" style="position:fixed">
    {% for element in elements %}
      <div class="element" style="border:1px;border-style:outset;border-radius:5px" data-name="{{ element.name }}" data-filepath="{{ element.filePath }}">
        {% if element.image %}
          <img src="{{ element.image }}" style="width:70px;height:70px">
        {% else %}
          <img src="../static/images/Manda-Pie-Back-To-School-Books.ico" alt="Mountain View" style="width:70px;height:70px">
        {% endif %}
        <br>
        &nbsp;&nbsp;{{ element.name }}
      </div>
      <br>
    {% endfor %}
  </div>
  <!-- Question List -->
  <div class="col-md-9 col-md-offset-2" id="questionList">
    <div class="row">
      <div id="elementWell" class="elementWell EDIT_ONLY" style="border:1px;border-style:dashed;border-radius:5px;height:300px" align="center">
        <br><br>To begin, drag elements onto the screen.
      </div>
    </div>
    <br>

      <div class="row">
          
          <button type="button" class="btn btn-default btn-lg dropdown-toggle pull-right TAKE_ONLY PREVIEW_ONLY" data-toggle="dropdown" aria-expanded="false">
            Submit <span class="caret"></span>
          </button>
          <ul class="dropdown-menu pull-right" role="menu" id="taskbuilder_viewable_courses"></ul>
          <p class="pull-right PREVIEW_ONLY">&nbsp;&nbsp;</p>
          <button type="button" class="btn btn-lg btn-success pull-right PREVIEW_ONLY" aria-expanded="false" id="preview">
            Preview
          </button>
          <p class="pull-right PREVIEW_ONLY">&nbsp;&nbsp;</p>
          <button type="button" class="btn btn-danger btn-lg pull-right EDIT_ONLY" aria-expanded="false" id="delete-all">
            Delete All
          </button>
      
      </div>


<!--     <div class="row">
        <input type="button" value="Preview" class="btn btn-success btn-lg pull-right PREVIEW_ONLY" id="preview">
        <p class="pull-right PREVIEW_ONLY">&nbsp;&nbsp;</p>
        <input type="button" value="Delete All" id="delete-all" class="btn btn-danger btn-lg pull-right EDIT_ONLY">
        <p class="pull-right PREVIEW_ONLY">&nbsp;&nbsp;</p>
        <input type="button" value="Submit" id="submit" class="btn btn-default btn-lg pull-right TAKE_ONLY PREVIEW_ONLY" style="display:None">
    </div> -->
  </div>
</div>
{% endblock %}
{% block js_bottom %}
{{ super() }}
<link rel="stylesheet" href="{{url_for('static', filename='jquery-ui-1.10.3.custom/development-bundle/themes/smoothness/jquery-ui.css')}}" />
<script src="{{url_for('static', filename='jquery-ui-1.10.3.custom/js/jquery-ui-1.10.3.custom.min.js')}}"></script>
<script type="text/javascript">
  var nextChoiceID = "choice" + 0;
  var nextQuestionID = "question" + 0;

  $(document).ready(function(){
    
    makeDroppable($('div.elementWell'));

    getVisibleCourses();

    $("div.element").draggable({
      scroll: true,
      revert: true,
      distance: 25,
      stack: "div.element"
    });

    $('#preview').click(function(){
      $('.EDIT_ONLY').toggle();
      $('.TAKE_ONLY').toggle();
      if ($(this).val() == "Preview"){
        $(this).val("Edit");
      }
      else {
        $(this).val("Preview");
      }
    });

    $('#submit').click(function(){
      $('.EDIT_ONLY').remove();
      $('.PREVIEW_ONLY').remove();
      var questions = [];
      $('.automatic-grading').each(function(){
        var question = $(this);
        var data = {};
        data['options'] = [];
        data['questionID'] = question.attr('id');
        question.find(':radio:visible').each(function(){
          data['options'].push($(this).attr('id'));
        });
        data['correctOption'] = question.find(':radio:checked').attr('id');
        questions.push(data);
      })
      var data = {};
      data['html'] = $('#questionList').html();
      data['questions'] = questions;
      $.ajax({
        url: '{{ url_for("taskBuilder") }}',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(data),
        error: function(data){
          console.log(data);
        }
      });
    });

  });
</script>

{% endblock %}